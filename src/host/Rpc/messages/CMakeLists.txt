set(PROJECT GeneratedRpc)

set(PROTO_FILES
    requests.proto)

set(GRPC_FILES
    requests.proto)

# workaround to change generated files location
file(MAKE_DIRECTORY "${GEN_DIR}/messages")
set(CURRENT_BINARY_DIR "${CMAKE_CURRENT_BINARY_DIR}")
set(CMAKE_CURRENT_BINARY_DIR "${GEN_DIR}/messages")

PROTOBUF_GENERATE_CPP(GENERATED_PROTO_SOURCES GENERATED_PROTO_HEADERS ${PROTO_FILES})
PROTOBUF_GENERATE_GRPC_CPP(GENERATED_GRPC_SOURCES GENERATED_GRPC_HEADERS ${GRPC_FILES})

set(CMAKE_CURRENT_BINARY_DIR "${CURRENT_BINARY_DIR}")

set(HEADERS ${GENERATED_PROTO_HEADERS} ${GENERATED_GRPC_HEADERS})
set(SOURCES ${GENERATED_PROTO_SOURCES} ${GENERATED_GRPC_SOURCES})

make_library()

target_include_directories(${PROJECT}
    PUBLIC ${PROTOBUF_INCLUDE_DIRS}
    INTERFACE ${GEN_DIR})

target_link_libraries(${PROJECT} PUBLIC ${PROTOBUF_LIBRARIES})

